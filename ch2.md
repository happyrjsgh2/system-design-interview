# 2장 개략적인 규모 추정

- 시스템 설계 면접을 볼때 때로는 시스템 용량이나 성능 요구사항을 개략적으로 추정해보라는 요구를 받게된다.
- 보편적으로 통용되는 성능 수치상에서 사고 실험을 통해 추정치를 계산하는 행위
    - 어떤 설계가 요구사항에 부합할 것인지 보기 위한 것.
- 2의 제곱수, latency 값 그리고 가용성에 관계된 수치를 기본적으로 이해하고 있어야 한다.

## 2의 제곱수

- 데이터 볼륨의 단위를 2의 제곱수로 표현하면 어떻게 되는지를 우선 알아야 함.
- 최소 단위는 1바이트이고, 8비트로 구성된다.

| 2의 x 제곱 | 근사치 | 이름 | 축약형 |
| --- | --- | --- | --- |
| 10 | 천 | 1킬로바이트 | 1KB |
| 20 | 백만 | 1메가바이트 | 1MB |
| 30 | 10억 | 1기가바이트 | 1GB |
| 40 | 1조 | 1테라바이트 | 1TB |
| 50 | 1000조 | 1페타바이트 | 1PB |

## 모든 프로그래머가 알아야 하는 응답지연 값

| 연산명 | 시간 |
| --- | --- |
| L1 캐시 참조 | 0.5ns |
| 분기 예측 오류 | 5ns |
| L2 캐시 참조 | 7ns |
| 뮤텍스 락/언락 | 100ns |
| 주 메모리 참조 | 100ns |
| Zippy로 1KB 압축 | 10,000ns = 10us |
| 1 Gbps 네트워크로 2KB 전송 | 20,000ns = 20us |
| 메모리에서 1MB 순차적으로 read | 250,000ns = 250us |
| 같은 데이터 센터 내에서의 메시지 왕복 지연시간 | 500,000ns = 500us |
| 디스크 탐색(seek) | 10,000,000ns = 10ms |
| 네트워크에서 1 MB 순차적으로 read | 10,000,000ns = 10ms |
| 디스크에서  1 MB 순차적으로 read | 30,000,000ns = 30ms |
| 한 패킷의 캘리포니아로부터 네덜란드까지의 왕복 지연시간 | 150,000,000ns = 150ms |

## 가용성에 관계된 수치들

SLA(Service Level Agreement)는 서비스 사업자가 보편적으로 사용하는 용어로, 서비스 사업자와 고객 사이에 맺어진 합의를 의미한다.

이 합의에는 사업자가 제공하는 서비스의 가용시간(uptime)이 공식적으로 기술되어 있다.

| 가용률 | 하루당 장애시간 | 주당 장애시간 | 개월당 장애시간 | 연간 장애시간 |
| --- | --- | --- | --- | --- |
| 99% | 14.40분 | 1.68시간 | 7.31시간 | 3.65일 |
| 99.9% | 1.44분 | 10.08분 | 43.83분 | 8.77시간 |
| 99.99% | 8.64초 | 1.01분 | 4.38분 | 52.60분 |
| 99.999% | 864.00밀리초 | 6.05초 | 26.30초 | 5.26분 |
| 99.9999% | 86.40밀리초 | 604.80밀리초 | 2.63초 | 31.56초 |

## 예제 : 트위터 QPS와 저장소 요구랑 추정

가정

- 월간 능동 사용자 (mau) 3억
- 50%의 사용자가 트위터를 매일 사용
- 각 사용자는 평균 매일 2건의 트윗을 올린다
- 미디어를 포함하는 트윗은 10% 정도이다
- 데이터는 5년간 보관된다

추정

QPS 추정치

- 일간 능동 사용자(DAU) = 3억 * 50% = 1.5억
- QPS = 1.5억 * 2트윗 / 24시간 / 3600초
- 최대 QPS = 2 * QPS = 약 7000

미디어 저장을 위한 저장소 요구랑

- 평균 트윗 크기
    - tweet_id = 64 byte
    - 텍스트  = 140byte
    - 미디어 = 1 MB
- 미디어 저장소 요구량 : 1.5억 * 2 * 10% * 1MB = 30TB / 일
- 5년간 미디어를 보관하기 위한 저장소 요구량 : 30TB * 365 * 5 = 약 55 PB

## 팁

개략적인 규모 추정과 관계된 면접에서 가장 중요한 것은 문제를 풀어나가는 절차다.

올바른 절차를 밟느냐가 결과를 내는것보다 중요하다.

도움될 몇가지 팁은 아래와 같다.

- 근사치를 활용한 계산 : 면접장에서 정확한 계산 능력을 보려는게 아니므로 적절한 근사치를 활용하도록 하자
- 가정들은 적어두라. 나중에 살펴볼 수 있도록
- 단위를 붙이자. 5라고만 적어두면 5kb인지 5mb인지 알 수 없다. 단위를 붙이는 습관을 들여야 모호함을 방지할 수 있다.
- 많이 출제되는 개략적 규모 추정 문제는 QPS, 최대 QPS, 저장소 요구량, 캐시 요구량, 서버 수 등을 추정하는 것이다.